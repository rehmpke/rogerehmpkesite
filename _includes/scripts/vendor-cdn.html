<!--Loading JavaScripts
==================================================-->
<script src="./assets/js/index.js"></script>

<!-- GPT Assistant Chat Widget -->
<div id="ai-widget-button">ðŸ’¬ Ask Me About My Work</div>
<div id="ai-widget-box" style="display:none">
    <div id="ai-widget-log" aria-live="polite"></div>
    <textarea id="ai-widget-input" placeholder="Ask me about my AI projects..."></textarea>
    <button onclick="submitPrompt()">Ask</button>
</div>

<style>
    #ai-widget-button {
        position: fixed;
        bottom: 1rem;
        right: 1rem;
        background: #00558C;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        cursor: pointer;
        z-index: 999;
    }

    #ai-widget-box {
        position: fixed;
        bottom: 4rem;
        right: 1rem;
        background: white;
        width: 300px;
        border: 1px solid #ccc;
        padding: 1rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
        z-index: 998;
    }

    #ai-widget-log {
        max-height: 200px;
        overflow-y: auto;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }

    #ai-widget-input {
        width: 100%;
        height: 60px;
        color: #000;
    }
</style>

<script>
    const endpoint = "https://tei23dyloh.execute-api.us-east-1.amazonaws.com/prod/gptAssistantHandler";
    const introText = `
Roger Ehmpke leads UX, accessibility, and CMS strategy at Kankakee Community College. 
He helps mission-driven teams simplify complex systems through clarity, inclusive design, 
and web governance. 

Heâ€™s known for shaping digital transformation in higher ed and mentoring designers and developers. 
Previously a web design instructor and CMS architect, he builds accessible platforms that scale. 
Ask about his AI-first prototypes, leadership roles, or team coaching.

If you're looking to collaborate or connect, the contact form is available at the bottom of this page.
`;

    let chatHistory = [];
    if (sessionStorage.getItem("gptChatHistory")) {
        try {
            chatHistory = JSON.parse(sessionStorage.getItem("gptChatHistory")) || [];
        } catch (e) {
            chatHistory = [];
        }
    }

    document.getElementById('ai-widget-button').onclick = () => {
        const box = document.getElementById('ai-widget-box');
        box.style.display = box.style.display === 'none' ? 'block' : 'none';
    };

    function submitPrompt() {
        const input = document.getElementById('ai-widget-input').value;
        const log = document.getElementById('ai-widget-log');
        chatHistory.push({ role: "user", content: input });
        sessionStorage.setItem("gptChatHistory", JSON.stringify(chatHistory));
        log.innerHTML += `<p><strong>You:</strong> ${input}</p>`;

        fetch(endpoint, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                question: input,
                contextBlock: introText,
                messageHistory: chatHistory
            })
        })
            .then(res => res.json())
            .then(data => {
                chatHistory.push({ role: "assistant", content: data.answer });
                sessionStorage.setItem("gptChatHistory", JSON.stringify(chatHistory));
                log.innerHTML += `<p><strong>Assistant:</strong> ${data.answer}<br><em>Need more info? <a href='#contact'>Contact Roger here.</a></em></p>`;
                document.getElementById('ai-widget-input').value = '';
            })
            .catch(err => {
                log.innerHTML += `<p><em>Error connecting to assistant.</em></p>`;
            });
    }
</script>