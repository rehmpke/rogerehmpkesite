<!--Loading JavaScripts
==================================================-->
<script src="./assets/js/index.js"></script>

<!-- ðŸš€ Roger's Personal AI Assistant -->
<div id="ai-widget-button">ðŸ’¬ Ask Me About My Work</div>
<div id="ai-widget-box" style="display:none">
    <div id="ai-widget-log" aria-live="polite"></div>
    <textarea id="ai-widget-input" placeholder="Ask me about my AI projects..."></textarea>
    <button onclick="submitPrompt()">Ask</button>
</div>

<style>
    #ai-widget-button {
        position: fixed;
        bottom: 1rem;
        right: 1rem;
        background: #00558C;
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        cursor: pointer;
        z-index: 999;
    }

    #ai-widget-box {
        position: fixed;
        bottom: 4rem;
        right: 1rem;
        background: white;
        width: 300px;
        border: 1px solid #ccc;
        padding: 1rem;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
        z-index: 998;
    }

    #ai-widget-log {
        max-height: 200px;
        overflow-y: auto;
        font-size: 0.9rem;
        margin-bottom: 0.5rem;
    }

    #ai-widget-input {
        width: 100%;
        height: 60px;
        color: #000;
    }
</style>

<script>
    const endpoint = "https://tei23dyloh.execute-api.us-east-1.amazonaws.com/prod/gptAssistantHandler";
    const introText = "Roger Ehmpke is a digital strategist focused on AI-first design in higher ed. This assistant answers based on his projects, ethics, and strategy work.";
    let chatHistory = [];

    document.getElementById('ai-widget-button').onclick = () => {
        const box = document.getElementById('ai-widget-box');
        box.style.display = box.style.display === 'none' ? 'block' : 'none';
    };

    function submitPrompt() {
        const input = document.getElementById('ai-widget-input').value;
        const log = document.getElementById('ai-widget-log');
        chatHistory.push({ role: "user", content: input });
        log.innerHTML += `<p><strong>You:</strong> ${input}</p>`;

        fetch(endpoint, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                question: input,
                contextBlock: introText,
                messageHistory: chatHistory
            })
        })
            .then(res => res.json())
            .then(data => {
                chatHistory.push({ role: "assistant", content: data.answer });
                log.innerHTML += `<p><strong>Assistant:</strong> ${data.answer}</p>`;
                document.getElementById('ai-widget-input').value = '';
            })
            .catch(err => {
                log.innerHTML += `<p><em>Error connecting to assistant.</em></p>`;
            });
    }
</script>